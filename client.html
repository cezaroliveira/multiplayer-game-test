<html>
  <head>
    <meta charset="utf-8" />
    <title>Teste jogo multiplayer</title>
    <style>
      #screen {
        border: 10px solid #ccc;
        image-rendering: pixelated;
        image-rendering: crisp-edges;
        image-rendering: -moz-crisp-edges;
        width: 400px;
        height: 400px;
      }
    </style>
  </head>
  <body>
    <canvas id="screen" width="10" height="10"></canvas>
    <script>
      const screen = document.getElementById('screen');
      const context = screen.getContext('2d');
      const currentPlayerId = 'player1';

      // Define the game elements
      const game = createGame();

      function createGame() {
        const state = {
          players: {
            player1: { x: 1, y: 1 },
            player2: { x: 9, y: 9 },
          },
          fruits: {
            fruit1: { x: 3, y: 1 },
          },
        };

        function movePlayer(command) {
          const keyPressed = event.key;

          const currentPlayer = state.players[currentPlayerId];

          if (keyPressed === "ArrowUp" && currentPlayer.y > 0) {
            currentPlayer.y--;
          } else if (keyPressed === "ArrowDown" && currentPlayer.y + 1 < screen.height) {
            currentPlayer.y++;
          } else if (keyPressed === "ArrowLeft" && currentPlayer.x > 0) {
            currentPlayer.x--;
          } else if (keyPressed === "ArrowRight" && currentPlayer.x + 1 < screen.width) {
            currentPlayer.x++;
          }
        }

        return {
          state,
          movePlayer
        };
      }

      document.addEventListener("keydown", handleKeyDown);

      function handleKeyDown(event) {
        const keyPressed = event.key;

        const currentPlayer = game.state.players[currentPlayerId];

        const command = {
          playerId: 'player1',
          keyPressed
        }

        game.movePlayer(command);
      }

      renderScreen();

      /**
       * Render the screen elements
       */
      function renderScreen() {
        // Clear all the screen area
        context.clearRect(0, 0, screen.width, screen.height);

        renderElements(game.state.players, 'black');
        renderElements(game.state.fruits, 'green');

        /**
         * Render the elements
         */
        function renderElements(elementsArray, color) {
          for (const elementId in elementsArray) {
            const element = elementsArray[elementId];
            context.fillStyle = color;
            context.fillRect(element.x, element.y, 1, 1);
          }
        }

        // Callback to update the screen continually
        requestAnimationFrame(renderScreen);
      }
    </script>
  </body>
</html>
